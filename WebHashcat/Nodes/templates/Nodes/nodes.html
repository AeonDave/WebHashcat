{% extends "base.html" %}
{% block breadcrumb %}Nodes{% endblock %}
{% block title %}Nodes{% endblock %}

{% block content %}
<div class="card rounded-xl p-4 mb-4">
  <div class="flex items-center justify-between mb-2">
    <div class="text-lg font-semibold text-gray-100">Nodes ({{ node_list|length }})</div>
    <button data-modal-target="action_new_node" data-modal-toggle="action_new_node" class="px-3 py-1.5 text-sm rounded-md bg-primary/20 text-primary border border-primary/40 hover:bg-primary/30">New node</button>
  </div>
  <table class="w-full text-sm">
    <thead class="text-gray-400">
    <tr>
      <th class="text-left py-2">Name</th>
      <th class="text-left py-2">Host</th>
      <th class="text-left py-2">Port</th>
      <th class="text-left py-2">Sync</th>
      <th class="text-right py-2">Actions</th>
    </tr>
    </thead>
    <tbody>
    {% for row in node_rows %}
    {% with node=row.obj status=row.status %}
    <tr class="border-t border-gray-800">
      <td class="py-2"><a class="text-primary hover:underline" href="{% url "Nodes:node" node.name %}">{{ node.name }}</a></td>
      <td class="py-2">{{ node.hostname }}</td>
      <td class="py-2">{{ node.port }}</td>
      <td class="py-2">
        {% if status.state == "ok" %}
          <span class="px-2 py-1 rounded bg-emerald-900/40 text-emerald-200 border border-emerald-700 text-xs">{{ status.label }}</span>
        {% elif status.state == "stale" %}
          <span class="px-2 py-1 rounded bg-amber-900/40 text-amber-200 border border-amber-700 text-xs">{{ status.label }}</span>
        {% else %}
          <span class="px-2 py-1 rounded bg-red-900/40 text-red-200 border border-red-700 text-xs">{{ status.label }}</span>
        {% endif %}
      </td>
      <td class="py-2 text-right">
        <form style="display:inline;" action="{% url "Nodes:node" node.name %}" method="post" class="mr-2" data-sync-form>
          {% csrf_token %}
          <input type="hidden" name="action" value="synchronize">
          <button type="submit" class="px-2 py-1 rounded bg-primary/20 border border-primary/40 text-primary text-xs">Sync</button>
        </form>
        <a href="{% url "Nodes:delete_node" node.name %}">
          <button type="button" class="px-2 py-1 rounded bg-red-900/40 border border-red-700 text-red-200 text-xs"><span class="glyphicon glyphicon-remove"></span> Remove</button>
        </a>
      </td>
    </tr>
    {% endwith %}
    {% endfor %}
    </tbody>
  </table>
</div>

<!-- Modal: new node -->
<div id="action_new_node" tabindex="-1" aria-hidden="true" class="fixed top-0 left-0 right-0 z-50 hidden w-full p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-full">
  <div class="relative w-full max-w-lg">
    <div class="relative rounded-lg shadow card p-6">
      <div class="flex items-center justify-between border-b border-gray-800 pb-3 mb-4">
        <h3 class="text-xl font-semibold text-gray-100">New node</h3>
        <button type="button" class="text-gray-400 hover:text-white" data-modal-hide="action_new_node">&times;</button>
      </div>
      <form action="{% url "Nodes:new_node" %}" enctype="multipart/form-data" method="post" class="space-y-3">
        {% csrf_token %}
        <label class="block text-sm">Name
          <input type="text" class="w-full rounded border border-gray-700 bg-[#0b1220] p-2 mt-1" id="name" name="name" required>
        </label>
        <label class="block text-sm">Hostname
          <input type="text" class="w-full rounded border border-gray-700 bg-[#0b1220] p-2 mt-1" id="hostname" name="hostname" required>
        </label>
        <label class="block text-sm">Port
          <input type="number" class="w-full rounded border border-gray-700 bg-[#0b1220] p-2 mt-1" id="port" name="port" required>
        </label>
        <label class="block text-sm">Username
          <input type="text" class="w-full rounded border border-gray-700 bg-[#0b1220] p-2 mt-1" id="username" name="username" required>
        </label>
        <label class="block text-sm">Password
          <input type="text" class="w-full rounded border border-gray-700 bg-[#0b1220] p-2 mt-1" id="password" name="password" required>
        </label>
        <div class="flex justify-end gap-2 pt-2">
          <button type="button" data-modal-hide="action_new_node" class="px-3 py-1.5 rounded border border-gray-700 text-gray-300">Cancel</button>
          <button type="submit" class="px-4 py-2 rounded bg-primary text-black font-semibold">Create</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
